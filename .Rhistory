"Country"="sd_iso_country_code__Intercept",
"Village"="sd_iso_country_code:gdlcode:village__Intercept",
"Project"="sd_id_form__Intercept",
"Unexplained"="sigma"
)
country_village_form <- loadRData("outputs/14_04_2023/outputs/overall_models/location_only/country_village_form.rda")
model <- country_village_form
model_name <- "country_village_form"
params_list <- params_list
draws <- as_draws_array(model)
mcmc_scatter <- mcmc_pairs(draws,pars = as.character(params_list))
mcmc_scatter + stat_ellipse(level = 0.9, color = "gray20", size = 1)
mcmc_scatter
mcmc_scatter <- mcmc_pairs(draws,pars = as.character(params_list))
mcmc_scatter
mcmc_scatter + stat_ellipse(level = 0.9, color = "gray20", size = 1)
mcmc_scatter + stat_ellipse(level = 0.9, color = "gray20", size = 1)
mcmc_scatter + stat_density_2d(color = "black", size = .5)
library(readr)
library(tidyr)
library(tibble)
library(magrittr)
library(dplyr)
library(tidybayes)
library(brms)
library(ggplot2)
library(bayesplot)
library(hexbin)
library(flextable)
mcmc_scatter + stat_density_2d(color = "black", size = .5)
mcmc_scatter <- mcmc_scatter + stat_density_2d(color = "black", size = .5)
mcmc_scatter
mcmc_scatter <- mcmc_pairs(draws,pars = as.character(params_list))
mcmc_scatter
source("~/research/phd/chapter-6-analysis/src/04-interpretation/02-overall-model.R", echo=TRUE)
model_name <- "weak_prior_fixed_effects"
indicator_data
#
#
opt <- list(
iter=20,
warmup=10,
data="./data/",
output="./outputs/test_overall_model_proj",
ncores=4,
index='1'
)
indicator_data <- readr::read_csv(paste0(opt$data,"/02-prepared-data/modelling_df.csv"))
indicator_data
indicator_data$logit_proportion_female_control
hist(indicator_data$logit_proportion_female_control)
hist(indicator_data$log_income_diversity)
log_livestock_tlu
hist(indicator_data$log_livestock_tlu)
hist(indicator_data$log_land_cultivated)
hist(indicator_data$logit_off_farm_orientation)
hist(indicator_data$logit_market_orientation)
hist(indicator_data$logit_proportion_female_control)
hist(indicator_data$log_income_diversity)
hist(indicator_data$norm_growing_period)
hist(indicator_data$log_min_travel_time)
hist(indicator_data$norm_gdl_lifexp)
models <-  list(
list(
tag="country_only",
data=indicator_data,
formula=bf(),
prior="weak",
)
)
indicator_data <- readr::read_csv(paste0(opt$data,"/02-prepared-data/modelling_df.csv"))
# opt <- list(
#   iter=20,
#   warmup=10,
#   data="./data/",
#   output="./outputs/test_overall_model_proj",
#   ncores=4,
#   index=1
# )
opt <- list(
iter=20,
warmup=10,
data="./data/",
output="./outputs/test_overall_model_proj",
ncores=4,
index=1
)
# sbatch src/03-modelling/02-location-only.sh
library(brms)
# library(ggplot2)
# library(ggridges)
library(dplyr)
library(tidyr)
# library(ggdist)
library(magrittr)
library(optparse)
library(fastDummies)
# library(projpred)
library(cmdstanr)
options(mc.cores = opt$ncores, brms.backend = "cmdstanr") # allows threading
opt$data <- gsub("/$", "", opt$data)
opt$output <- gsub("/$", "", opt$output)
dir.create(opt$output)
writeLines("test_file_output",paste0(opt$output,"/test_file.txt"))
indicator_data <- readr::read_csv(paste0(opt$data,"/02-prepared-data/modelling_df.csv"))
dir.create(paste0(opt$output,"/overall_models/"))
dir.create(paste0(opt$output,"/overall_models/location_only"))
models <-  list(
list(
tag="country_only",
data=indicator_data,
formula=bf(),
prior="weak",
)
)
models <-  list(
list(
tag="country_only",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code)),
prior="weak"
)
)
opt$index
models[[opt$index]]["formula"]
models[[opt$index]][["formula"]]
models[[opt$index]][["tag"]]
models <-  list(
list(
tag="country_only",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code)),
),
list(
tag="country_county",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode)),
),
list(
tag="country_county_village",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode) +
(1 | iso_country_code:gdlcode:village)),
),
list(
tag="country_county_village_kg",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode) +
(1 | iso_country_code:gdlcode:village)+
(1 | kg_class_name)),
),
list(
tag="country_county_village_kg_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode) +
(1 | iso_country_code:gdlcode:village)+
(1 | kg_class_name)+
(1 | id_form)),
),
list(
tag="country_county_village_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode) +
(1 | iso_country_code:gdlcode:village)+
(1 | id_form)),
),
list(
tag="country_county_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode) +
(1 | id_form)),
),
list(
tag="country_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | id_form)),
),
list(
tag="country_village_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode:village)+
(1 | id_form)),
),
list(
tag="country_village_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode:village)+
(1 | id_form)),
),
list(
tag="kg_only",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | kg_class_name)),
),
list(
tag="kg_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | kg_class_name)+
(1 | id_form)),
),
list(
tag="kg_village_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | kg_class_name)+
(1 | iso_country_code:gdlcode:village)+
(1 | id_form)),
),
list(
tag="country_kg_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code)+
(1 | kg_class_name)+
(1 | id_form)),
)
)
models <-  list(
list(
tag="country_only",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code))
),
list(
tag="country_county",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode))
),
list(
tag="country_county_village",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode) +
(1 | iso_country_code:gdlcode:village))
),
list(
tag="country_county_village_kg",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode) +
(1 | iso_country_code:gdlcode:village)+
(1 | kg_class_name))
),
list(
tag="country_county_village_kg_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode) +
(1 | iso_country_code:gdlcode:village)+
(1 | kg_class_name)+
(1 | id_form))
),
list(
tag="country_county_village_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode) +
(1 | iso_country_code:gdlcode:village)+
(1 | id_form))
),
list(
tag="country_county_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode) +
(1 | id_form))
),
list(
tag="country_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | id_form))
),
list(
tag="country_village_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode:village)+
(1 | id_form))
),
list(
tag="country_village_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code) +
(1 | iso_country_code:gdlcode:village)+
(1 | id_form))
),
list(
tag="kg_only",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | kg_class_name))
),
list(
tag="kg_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | kg_class_name)+
(1 | id_form))
),
list(
tag="kg_village_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | kg_class_name)+
(1 | iso_country_code:gdlcode:village)+
(1 | id_form))
),
list(
tag="country_kg_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code)+
(1 | kg_class_name)+
(1 | id_form))
)
)
models
i <- 14
# Running Model
model <- brm(
formula=models[[opt$index]][["formula"]],
data=models[[opt$index]][["data"]],
prior = c(
set_prior('normal(0, 1)', class = 'sd'),
set_prior('normal(0, 1)', class = 'sigma'),
set_prior('normal(0, 1)', class = 'Intercept')
),
cores = opt$ncores,
backend = "cmdstanr",
iter = opt$iter,
warmup = opt$warmup,
family=gaussian()
)
model
models[[opt$index]][["formula"]]
opt$index
opt$index <- 14
# Running Model
model <- brm(
formula=models[[opt$index]][["formula"]],
data=models[[opt$index]][["data"]],
prior = c(
set_prior('normal(0, 1)', class = 'sd'),
set_prior('normal(0, 1)', class = 'sigma'),
set_prior('normal(0, 1)', class = 'Intercept')
),
cores = opt$ncores,
backend = "cmdstanr",
iter = opt$iter,
warmup = opt$warmup,
family=gaussian()
)
model
paste0(opt$output,"/overall_models/location_only/",models[[opt$index]][["tag"]],".rda")
paste0(opt$output,"/overall_models/location_only/loo_",models[[opt$index]][["tag"]],".rda"
)
models <-  list(
# list(
#   tag="country_only",
#   data=indicator_data,
#   formula=bf(log_tva ~ 1 +
#                (1 | iso_country_code))
# ),
#
# list(
#   tag="country_county",
#   data=indicator_data,
#   formula=bf(log_tva ~ 1 +
#                (1 | iso_country_code) +
#                (1 | iso_country_code:gdlcode))
# ),
#
# list(
#   tag="country_county_village",
#   data=indicator_data,
#   formula=bf(log_tva ~ 1 +
#                (1 | iso_country_code) +
#                (1 | iso_country_code:gdlcode) +
#                (1 | iso_country_code:gdlcode:village))
# ),
#
# list(
#   tag="country_county_village_kg",
#   data=indicator_data,
#   formula=bf(log_tva ~ 1 +
#                (1 | iso_country_code) +
#                (1 | iso_country_code:gdlcode) +
#                (1 | iso_country_code:gdlcode:village)+
#                (1 | kg_class_name))
# ),
#
# list(
#   tag="country_county_village_kg_form",
#   data=indicator_data,
#   formula=bf(log_tva ~ 1 +
#                (1 | iso_country_code) +
#                (1 | iso_country_code:gdlcode) +
#                (1 | iso_country_code:gdlcode:village)+
#                (1 | kg_class_name)+
#                (1 | id_form))
# ),
#
# list(
#   tag="country_county_village_form",
#   data=indicator_data,
#   formula=bf(log_tva ~ 1 +
#                (1 | iso_country_code) +
#                (1 | iso_country_code:gdlcode) +
#                (1 | iso_country_code:gdlcode:village)+
#                (1 | id_form))
# ),
#
# list(
#   tag="country_county_form",
#   data=indicator_data,
#   formula=bf(log_tva ~ 1 +
#                (1 | iso_country_code) +
#                (1 | iso_country_code:gdlcode) +
#                (1 | id_form))
# ),
#
#
# list(
#   tag="country_form",
#   data=indicator_data,
#   formula=bf(log_tva ~ 1 +
#                (1 | iso_country_code) +
#                (1 | id_form))
# ),
#
# list(
#   tag="country_village_form",
#   data=indicator_data,
#   formula=bf(log_tva ~ 1 +
#                (1 | iso_country_code) +
#                (1 | iso_country_code:gdlcode:village)+
#                (1 | id_form))
# ),
#
# list(
#   tag="country_village_form",
#   data=indicator_data,
#   formula=bf(log_tva ~ 1 +
#                (1 | iso_country_code) +
#                (1 | iso_country_code:gdlcode:village)+
#                (1 | id_form))
# ),
list(
tag="kg_only",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | kg_class_name))
),
list(
tag="kg_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | kg_class_name)+
(1 | id_form))
),
list(
tag="kg_village_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | kg_class_name)+
(1 | iso_country_code:gdlcode:village)+
(1 | id_form))
),
list(
tag="country_kg_form",
data=indicator_data,
formula=bf(log_tva ~ 1 +
(1 | iso_country_code)+
(1 | kg_class_name)+
(1 | id_form))
)
)
models
