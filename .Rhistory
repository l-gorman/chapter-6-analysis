#                  pesticide+
#                  debts_have+
#                  aidreceived+
#                  livestock_inputs_any+
#                  land_irrigated_any+
#
#                  #------------------
#                # Village Level
#                norm_growing_period +
#                  log_min_travel_time +
#                  log_pop_dens +
#                  #------------------
#                #County Level
#                norm_gdl_country_shdi+
#
#                  # Levels
#                  (1 +
#                     log_land_cultivated +
#                     log_livestock_tlu +
#                     off_farm_any | iso_country_code) +
#                  (1 | iso_country_code:village)),
#     prior="horseshoe"),
#
# -------------------------------------------------------------------------
# -------------------------------------------------------------------------
# HDDS --------------------------------------------------------
# -------------------------------------------------------------------------
# -------------------------------------------------------------------------
# -------------------------------------------------------------------------
# -------------------------------------------------------------------------
# Weak Prior Model --------------------------------------------------------
# -------------------------------------------------------------------------
# -------------------------------------------------------------------------
list(
tag="weak_prior_fixed",
data=indicator_data,
formula=bf(norm_hdds_lean_season ~ 1 +
#------------------
#Household Level
# Demographics
log_hh_size +
education_cleaned +
#Assets
log_livestock_tlu +
log_land_cultivated +
# Practices
off_farm_any+
till_not_by_hand+
external_labour+
pesticide+
debts_have+
aidreceived+
livestock_inputs_any+
land_irrigated_any+
#------------------
# Village Level
norm_growing_period +
log_min_travel_time +
log_pop_dens +
#------------------
#County Level
norm_gdl_country_shdi+
# Levels
(1 | iso_country_code) +
(1 | iso_country_code:village)),
prior="weak"
)
# list(
#   tag="weak_prior_mixed_country",
#   data=indicator_data,
#   formula=bf(norm_hdds_lean_season ~ 1 +
#                #Household Level
#                # Demographics
#                log_hh_size +
#                education_cleaned +
#
#                #Assets
#                log_livestock_tlu +
#                log_land_cultivated +
#
#                # Practices
#                off_farm_any+
#                till_not_by_hand+
#                external_labour+
#                pesticide+
#                debts_have+
#                aidreceived+
#                livestock_inputs_any+
#                land_irrigated_any+
#                log_pop_dens +
#                #------------------
#              # Village Level
#              norm_growing_period +
#                log_min_travel_time +
#                log_pop_dens +
#                #------------------
#              #County Level
#              norm_gdl_country_shdi+
#                # Levels
#                (1 +
#                   log_land_cultivated +
#                   log_livestock_tlu +
#                   off_farm_any | iso_country_code) +
#                (1 | iso_country_code:village)),
#   prior="weak"),
#
# -------------------------------------------------------------------------
# -------------------------------------------------------------------------
# Horse Shoe Model --------------------------------------------------------
# -------------------------------------------------------------------------
# -------------------------------------------------------------------------
# list(
#   tag="horseshoe_fixed",
#   data=indicator_data,
#   formula=bf(norm_hdds_lean_season ~ 1 +
#                #Household Level
#                # Demographics
#                log_hh_size +
#                education_cleaned +
#
#                #Assets
#                log_livestock_tlu +
#                log_land_cultivated +
#
#                # Practices
#                off_farm_any+
#                till_not_by_hand+
#                external_labour+
#                pesticide+
#                debts_have+
#                aidreceived+
#                livestock_inputs_any+
#                land_irrigated_any+
#
#                #------------------
#              # Village Level
#              norm_growing_period +
#                log_min_travel_time +
#                log_pop_dens +
#                #------------------
#              #County Level
#              norm_gdl_country_shdi+
#
#                # Levels
#                (1 | iso_country_code) +
#                (1 | iso_country_code:village)),
#   prior="horseshoe"
# ),
#
#   list(
#     tag="horseshoe_mixed_country",
#     data=indicator_data,
#     formula=bf(norm_hdds_lean_season ~ 1 +
#                  #Household Level
#                  # Demographics
#                  log_hh_size +
#                  education_cleaned +
#
#                  #Assets
#                  log_livestock_tlu +
#                  log_land_cultivated +
#
#                  # Practices
#                  off_farm_any+
#                  till_not_by_hand+
#                  external_labour+
#                  pesticide+
#                  debts_have+
#                  aidreceived+
#                  livestock_inputs_any+
#                  land_irrigated_any+
#
#                  #------------------
#                # Village Level
#                norm_growing_period +
#                  log_min_travel_time +
#                  log_pop_dens +
#                  #------------------
#                #County Level
#                norm_gdl_country_shdi+
#
#                  # Levels
#                  (1 +
#                     log_land_cultivated +
#                     log_livestock_tlu +
#                     off_farm_any | iso_country_code) +
#                  (1 | iso_country_code:village)),
#     prior="horseshoe"),
# -------------------------------------------------------------------------
# -------------------------------------------------------------------------
# Fixed effects only ------------------------------------------------------
# -------------------------------------------------------------------------
# -------------------------------------------------------------------------
# list(
#   tag="weak_fixed_only",
#   data=indicator_data,
#   formula=bf(norm_hdds_lean_season ~ 1 +
#                #Household Level
#                # Demographics
#                log_hh_size +
#                education_cleaned +
#
#                #Assets
#                log_livestock_tlu +
#                log_land_cultivated +
#
#                # Practices
#                off_farm_any+
#                till_not_by_hand+
#                external_labour+
#                pesticide+
#                debts_have+
#                aidreceived+
#                livestock_inputs_any+
#                land_irrigated_any+
#
#                #------------------
#              # Village Level
#              norm_growing_period +
#                log_min_travel_time +
#                log_pop_dens +
#                #------------------
#              #County Level
#              norm_gdl_country_shdi),
#   prior="weak"),
#
# list(
#   tag="horseshoe_fixed_only",
#   data=indicator_data,
#   formula=bf(norm_hdds_lean_season ~ 1 +
#                #Household Level
#                # Demographics
#                log_hh_size +
#                education_cleaned +
#
#                #Assets
#                log_livestock_tlu +
#                log_land_cultivated +
#
#                # Practices
#                off_farm_any+
#                till_not_by_hand+
#                external_labour+
#                pesticide+
#                debts_have+
#                aidreceived+
#                livestock_inputs_any+
#                land_irrigated_any+
#
#                #------------------
#              # Village Level
#              norm_growing_period +
#                log_min_travel_time +
#                log_pop_dens +
#                #------------------
#              #County Level
#              norm_gdl_country_shdi),
#   prior="horseshoe"),
#
# list(
#   tag="weak_fixed_only",
#   data=indicator_data,
#   formula=bf(log_tva ~ 1 +
#                #Household Level
#                # Demographics
#                log_hh_size +
#                education_cleaned +
#
#                #Assets
#                log_livestock_tlu +
#                log_land_cultivated +
#
#                # Practices
#                off_farm_any+
#                till_not_by_hand+
#                external_labour+
#                pesticide+
#                debts_have+
#                aidreceived+
#                livestock_inputs_any+
#                land_irrigated_any+
#
#                #------------------
#              # Village Level
#              norm_growing_period +
#                log_min_travel_time +
#                log_pop_dens +
#                #------------------
#              #County Level
#              norm_gdl_country_shdi),
#   prior="weak"),
#
# list(
#   tag="horseshoe_fixed_only",
#   data=indicator_data,
#   formula=bf(log_tva ~ 1 +
#                #Household Level
#                # Demographics
#                log_hh_size +
#                education_cleaned +
#
#                #Assets
#                log_livestock_tlu +
#                log_land_cultivated +
#
#                # Practices
#                off_farm_any+
#                till_not_by_hand+
#                external_labour+
#                pesticide+
#                debts_have+
#                aidreceived+
#                livestock_inputs_any+
#                land_irrigated_any+
#
#                #------------------
#              # Village Level
#              norm_growing_period +
#                log_min_travel_time +
#                log_pop_dens +
#                #------------------
#              #County Level
#              norm_gdl_country_shdi),
#   prior="horseshoe")
)
length(models)
?brm
model <- loadRData("outputs/31_05_2023/outputs/overall_models/variable_addition/tva/weak_prior_fixed.rda")
loadRData <- function(fileName){
#loads an RData file, and returns it
load(fileName)
get(ls()[ls() != "fileName"])
}
model <- loadRData("outputs/31_05_2023/outputs/overall_models/variable_addition/tva/weak_prior_fixed.rda")
model
ref_model <- get_refmodel(model)
library(brms)
library(projpred)
ref_model <- get_refmodel(model)
ref_model
model
plot(model)
library(projpred)
library(brms)
?cv_varsel
2^16
2^17
2^18
2^15
2^14
2^12
2^13
2^10
2^12
auxilliary_variables <- c(
"log_hh_size",
'education_cleaned',
#Assets
'log_livestock_tlu',
'log_land_cultivated',
# Practices
'off_farm_any',
'till_not_by_hand',
'external_labour',
'pesticide',
'debts_have',
'aidreceived',
'livestock_inputs_any',
'land_irrigated_any',
#------------------
# Village Level
'norm_growing_period',
'log_min_travel_time',
'log_pop_dens',
#------------------
#County Level
'norm_gdl_country_shdi'
)
# Adapted from Frank Weber's Solution
# https://github.com/stan-dev/projpred/issues/346
get_search_terms <- function(fixed_terms, other_predictors, max_terms) {
if (max_terms > length(other_predictors)){
stop("Cannot have max terms more than predictors")
}
search_terms <- unlist(lapply(1:max_terms, function(m_predictors) {
lapply(combn(other_predictors, m = m_predictors, simplify = FALSE),
function(idxs_predictors) {
paste0(idxs_predictors, collapse = " + ")
})
}))
search_terms <- c(fixed_terms, paste(fixed_terms, "+", search_terms))
return(search_terms)
}
auxilliary_variables <- c(
"log_hh_size",
'education_cleaned',
#Assets
'log_livestock_tlu',
'log_land_cultivated',
# Practices
'off_farm_any',
'till_not_by_hand',
'external_labour',
'pesticide',
'debts_have',
'aidreceived',
'livestock_inputs_any',
'land_irrigated_any',
#------------------
# Village Level
'norm_growing_period',
'log_min_travel_time',
'log_pop_dens',
#------------------
#County Level
'norm_gdl_country_shdi'
)
group_effects <-"(1 | iso_country_code) + (1 | iso_country_code:village)"
# Basing this off of discussion on stan forum:
# https://discourse.mc-stan.org/t/projpred-fixing-group-effects-in-search-terms-and-tips-for-speed/31678/4
search_terms <- get_search_terms(group_effects,auxilliary_variables, max_terms=12)
search_terms
length(search_terms)
# Adapted from Frank Weber's Solution
# https://github.com/stan-dev/projpred/issues/346
get_search_terms <- function(fixed_terms, other_predictors, max_terms) {
if (max_terms > length(other_predictors)){
stop("Cannot have max terms more than predictors")
}
search_terms <- unlist(lapply(1:max_terms, function(m_predictors) {
lapply(combn(other_predictors, m = m_predictors, simplify = FALSE),
function(idxs_predictors) {
paste0(idxs_predictors, collapse = " + ")
})
}))
search_terms <- c(fixed_terms, paste(fixed_terms, "+", search_terms))
return(search_terms)
}
max_terms=12
other_predictors
other_predictors <- auxilliary_variables
fixed_terms <- group_effects
max_terms
m_predictors <- 12
lapply(combn(other_predictors, m = m_predictors, simplify = FALSE),
function(idxs_predictors) {
paste0(idxs_predictors, collapse = " + ")
})
search_terms <- unlist(lapply(1:max_terms, function(m_predictors) {
lapply(combn(other_predictors, m = m_predictors, simplify = FALSE),
function(idxs_predictors) {
paste0(idxs_predictors, collapse = " + ")
})
}))
search_terms
max_terms <-
2
search_terms <- unlist(lapply(1:max_terms, function(m_predictors) {
lapply(combn(other_predictors, m = m_predictors, simplify = FALSE),
function(idxs_predictors) {
paste0(idxs_predictors, collapse = " + ")
})
}))
search_terms
# Adapted from Frank Weber's Solution
# https://github.com/stan-dev/projpred/issues/346
get_search_terms <- function(fixed_terms, other_predictors, max_terms) {
if (max_terms > length(other_predictors)){
stop("Cannot have max terms more than predictors")
}
search_terms <- unlist(lapply(1:max_terms, function(m_predictors) {
lapply(combn(other_predictors, m = m_predictors, simplify = FALSE),
function(idxs_predictors) {
paste0(idxs_predictors, collapse = " + ")
})
}))
search_terms <- c(fixed_terms, paste(fixed_terms, "+", search_terms))
return(search_terms)
}
auxilliary_variables <- c(
"log_hh_size",
'education_cleaned',
#Assets
'log_livestock_tlu',
'log_land_cultivated',
# Practices
'off_farm_any',
'till_not_by_hand',
'external_labour',
'pesticide',
'debts_have',
'aidreceived',
'livestock_inputs_any',
'land_irrigated_any',
#------------------
# Village Level
'norm_growing_period',
'log_min_travel_time',
'log_pop_dens',
#------------------
#County Level
'norm_gdl_country_shdi'
)
group_effects <-"(1 | iso_country_code) + (1 | iso_country_code:village)"
# Basing this off of discussion on stan forum:
# https://discourse.mc-stan.org/t/projpred-fixing-group-effects-in-search-terms-and-tips-for-speed/31678/4
search_terms <- get_search_terms(group_effects,auxilliary_variables, max_terms=12)
?simplify2array
devtools::install_github("l-gorman/projpred")
renv::status
renv::status()
renv::snapshot()
